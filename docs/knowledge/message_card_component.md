# MessageCard 组件

## 概述

MessageCard 是 Kagami Console Web 前端的核心 UI 组件，专门用于展示 LLM 调用输入中的单个消息项。该组件将 JSON 格式的消息数据转换为用户友好的卡片式界面。

## 功能特性

### 核心功能
- **角色标识**：在卡片顶部显示消息角色（user/assistant/system）
- **内容智能展示**：根据内容类型自动选择展示方式
- **错误处理**：优雅处理数据异常和格式错误
- **深色主题**：与控制台整体风格保持一致

### 角色标签系统
```typescript
角色映射：
- user: "用户" (蓝色标签)
- assistant: "助手" (绿色标签)  
- system: "系统" (橙色标签)
- 其他: 原始角色名 (默认标签)
```

### 内容展示逻辑
- **JSON 对象**：使用深色代码高亮显示格式化JSON
- **字符串**：保持原生格式，支持换行和markdown字符
- **空内容**：显示友好的信息提示
- **异常数据**：显示错误信息和降级处理

## 技术实现

### 数据接口
```typescript
interface MessageItem {
    role: string;           // 消息角色
    content: unknown;       // 消息内容（string 或 object）
}

interface MessageCardProps {
    message: MessageItem | null;  // 消息数据
    index: number;                // 消息索引（从0开始）
}
```

### 样式设计
```typescript
卡片样式：
- 背景色：#141414 (深色主题)
- 边框色：#434343
- 间距：16px 底部间距

标题样式：
- 背景色：#262626
- 文字色：#ffffff
- 标签：role颜色编码

内容区样式：
- JSON：#1f1f1f背景，#e1e4e8文字
- 文本：#0d1117背景，#c9d1d9文字
- 字体：SFMono-Regular等宽字体
- 最大高度：400px（支持滚动）
```

### 错误处理机制
1. **消息对象验证**：检查message和role字段完整性
2. **内容类型检测**：安全的类型判断和转换
3. **JSON序列化保护**：try-catch包装，避免序列化异常
4. **友好错误提示**：使用Ant Design Alert组件显示错误信息
5. **降级处理**：出错时回退到基础文本显示

## 使用场景

### 主要用途
- **LLM调用详情展示**：在详情模态框中展示消息列表
- **对话历史查看**：结构化显示用户-助手对话
- **系统消息展示**：显示系统提示和配置信息

### 集成位置
- 文件：`kagami-console-web/src/components/LLMLogsTable.tsx`
- 位置：详情模态框 → 输入区域 → MessageCard列表
- 触发：用户点击"详情"按钮查看LLM调用输入

## 组件层次结构

```
LLMLogsTable
└── Modal (详情模态框)
    ├── 基本信息区域
    ├── 输入区域
    │   └── MessageCard[] (消息卡片列表)
    │       ├── Card (Ant Design)
    │       │   ├── 标题区域
    │       │   │   ├── 消息序号
    │       │   │   └── Role标签
    │       │   └── 内容区域
    │       │       ├── JSON代码块 | 文本预格式化
    │       │       └── 错误提示组件
    └── 输出区域
```

## 性能特性

### 优化措施
- **条件渲染**：仅在需要时解析和渲染内容
- **内容截断**：最大高度限制，防止页面卡顿
- **类型缓存**：避免重复的类型检测操作
- **错误边界**：组件级错误隔离，不影响整体界面

### 内存管理
- **轻量级依赖**：仅依赖Ant Design核心组件
- **无状态设计**：纯展示组件，无内部状态管理
- **及时清理**：模态框关闭时自动释放组件资源

## 扩展能力

### 未来可扩展特性
- **语法高亮**：集成代码高亮库支持多语言
- **复制功能**：添加内容复制到剪贴板功能
- **折叠展开**：长内容的折叠展开交互
- **搜索高亮**：支持关键词搜索和高亮显示
- **导出功能**：支持单个消息或整个对话的导出

## 关联节点

- [[console_system]] - 所属的控制台系统
- [[llm_client]] - 提供消息数据来源
- [[message_data_model]] - 相关的数据模型定义